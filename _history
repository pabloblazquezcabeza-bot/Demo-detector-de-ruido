{"entries":[{"timestamp":1764838326818,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":8794,"diffs":[[1,"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":71,"diffs":[[1,""]]},{"start1":1,"length1":941,"diffs":[[1,""]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":128,"length1":58,"diffs":[[1,"        \"microphone\": \"*\"\n"]]},{"start1":245,"length1":31,"diffs":[[1,"    \"additionalFilePaths\": []\n"]]}]}]},{"timestamp":1764838897434,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":12900,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"HtTjev/6/?BMcz6(pE,n\">MUESTRAS</variable><variable id=\"z~M_iN;AFVP[6iP@C*AU\">nivel</variable><variable id=\"B}75PAd20NJyI=Q[-Jud\">suma</variable><variable id=\"vf?=~.;/a_@^V;nY|_|l\">pico</variable><variable id=\"ry!G:Ypv$DE}9G@O6QN4\">promedio</variable><variable id=\"uk#i!+.82YiJi)Gqoeo8\">col</variable><variable id=\"Y%R7Ohi/=vBC{-rYmGO]\">LIMITE_RUIDO</variable></variables><comment x=\"1468\" y=\"20\" w=\"480\" h=\"120\">\nDetector de ruido corregido para MakeCode (micro:bit V2)\nUsa input.soundLevel() (integrado en V2). Si instalas la extensi√≥n \"Sound Level in decibels\"\n</comment><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Y%R7Ohi/=vBC{-rYmGO]\">LIMITE_RUIDO</field><comment pinned=\"false\" h=\"80\" w=\"160\">ajusta seg√∫n tu entorno (0-255)</comment><data>0</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">150</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"HtTjev/6/?BMcz6(pE,n\">MUESTRAS</field><comment pinned=\"false\" h=\"80\" w=\"160\">n¬∫ de lecturas r√°pidas para calcular promedio</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">8</field></shadow></value></block></next></block></statement></block><block type=\"device_forever\" x=\"416\" y=\"20\"><comment pinned=\"false\" h=\"80\" w=\"160\">n¬∫ de lecturas r√°pidas para calcular promedio</comment><statement name=\"HANDLER\"><block type=\"controls_repeat_ext\"><comment pinned=\"false\" h=\"80\" w=\"160\">Tomar MUESTRAS lecturas r√°pidas del micr√≥fono</comment><value name=\"TIMES\"><shadow type=\"math_whole_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HtTjev/6/?BMcz6(pE,n\">MUESTRAS</field></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"z~M_iN;AFVP[6iP@C*AU\">nivel</field><comment pinned=\"false\" h=\"80\" w=\"160\">funci√≥n integrada (0..255)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"variables_change\"><field name=\"VAR\" id=\"B}75PAd20NJyI=Q[-Jud\">suma</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"z~M_iN;AFVP[6iP@C*AU\">nivel</field></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"z~M_iN;AFVP[6iP@C*AU\">nivel</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"vf?=~.;/a_@^V;nY|_|l\">pico</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"vf?=~.;/a_@^V;nY|_|l\">pico</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"z~M_iN;AFVP[6iP@C*AU\">nivel</field></block></value></block></statement><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">peque√±a pausa entre lecturas (ajusta si quieres mayor resoluci√≥n)</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">20</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"ry!G:Ypv$DE}9G@O6QN4\">promedio</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"B}75PAd20NJyI=Q[-Jud\">suma</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HtTjev/6/?BMcz6(pE,n\">MUESTRAS</field></block></value></block></value></block></value><next><block type=\"pxt_controls_for\"><comment pinned=\"false\" h=\"80\" w=\"160\">Mostrar intensidad como barra en la fila inferior (0..4)\nLimites: cada LED representa ~51 unidades (255/5 ‚âà 51)</comment><value name=\"VAR\"><block type=\"variables_get_reporter\" deletable=\"false\"><field name=\"VAR\" id=\"uk#i!+.82YiJi)Gqoeo8\">col</field></block></value><value name=\"TO\"><shadow type=\"math_whole_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_number\"><field name=\"NUM\">4</field></block></value><statement name=\"DO\"><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ry!G:Ypv$DE}9G@O6QN4\">promedio</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"uk#i!+.82YiJi)Gqoeo8\">col</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">51</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"device_plot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"uk#i!+.82YiJi)Gqoeo8\">col</field></block></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">4</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"device_unplot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"uk#i!+.82YiJi)Gqoeo8\">col</field></block></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">4</field></shadow></value></block></statement></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Si detectamos pico o promedio alto -&gt; alerta parpadeante</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"vf?=~.;/a_@^V;nY|_|l\">pico</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Y%R7Ohi/=vBC{-rYmGO]\">LIMITE_RUIDO</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ry!G:Ypv$DE}9G@O6QN4\">promedio</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Y%R7Ohi/=vBC{-rYmGO]\">LIMITE_RUIDO</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.No</field><comment pinned=\"false\" h=\"80\" w=\"160\">Parpadeo de icono de alerta</comment><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"device_clear_display\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">150</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">peque√±a pausa antes de la siguiente ronda para ahorrar CPU</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value></block></next></block></next></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":302,"diffs":[[1,"let LIMITE_RUIDO = 150\nlet MUESTRAS = 5  // n√∫mero de lecturas r√°pidas\n\nrecorder.start() // Inicia el micr√≥fono\n\n"]]},{"start1":141,"length1":191,"diffs":[[1,"    let suma = 0\n    let pico = 0\n\n    // Tomar varias muestras r√°pidas del micr√≥fono\n    for (let i = 0; i < MUESTRAS; i++) {\n        let nivel = recorder.getSample() // funci√≥n de la extensi√≥n Grabar\n"]]},{"start1":428,"length1":38,"diffs":[[1,""]]},{"start1":458,"length1":584,"diffs":[[1,"\n    let promedio = Math.round(suma / MUESTRAS)\n\n    // Mostrar intensidad en la fila inferior de LEDs\n    for (let i = 0; i < 5; i++) {\n        if (promedio > i * 51) {\n            led.plot(i, 4)\n"]]},{"start1":672,"length1":29,"diffs":[[1,"            led.unplot(i, 4)\n"]]},{"start1":717,"length1":60,"diffs":[[1,"\n    // Si hay pico o promedio alto, alerta parpadeante\n"]]},{"start1":868,"length1":157,"diffs":[[1,"        basic.pause(200)\n"]]},{"start1":921,"length1":0,"diffs":[[1,"        basic.pause(150)\n"]]},{"start1":952,"length1":67,"diffs":[[1,"\n    basic.pause(50) // pausa antes de la siguiente ronda\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":155,"length1":89,"diffs":[[1,"        \"audio-recording\": \"*\"\n"]]},{"start1":277,"length1":35,"diffs":[[1,"    \"preferredEditor\": \"tsprj\"\n"]]}]}]},{"timestamp":1764839295641,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":10862,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"/)LB^}wgFg,p6FKKRi(W\">MUESTRAS</variable><variable id=\"|/k;@hs3yqI6;)uyx4v.\">nivel</variable><variable id=\"=Yy[jhR@:bB)VK/gn%?Z\">suma</variable><variable id=\".(Y}IOSKJ4x=O5j3*nC=\">pico</variable><variable id=\"X2p}7xVL4#EShI30nfm7\">promedio</variable><variable id=\"dD;15q1:n|*u`EBl[cu%\">ledsEncendidos</variable><variable id=\"a?7t#J,PpYJVu%(``SK9\">idx</variable><variable id=\"Y[*uhxBY^9E)^8rxY^;Q\">x</variable><variable id=\"1nlS9rRK?NPr;s6:st=N\">y</variable><variable id=\"[]zhPrr$3Yu324YEG%qT\">LIMITE_RUIDO</variable></variables><comment x=\"1448\" y=\"0\" w=\"460\" h=\"120\">\nDetector de ruido para MakeCode (micro:bit V2)\n</comment><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"[]zhPrr$3Yu324YEG%qT\">LIMITE_RUIDO</field><comment pinned=\"false\" h=\"80\" w=\"160\">Ajusta sensibilidad (0..255)</comment><data>0</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">140</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/)LB^}wgFg,p6FKKRi(W\">MUESTRAS</field><comment pinned=\"false\" h=\"80\" w=\"160\">N¬∫ de lecturas r√°pidas por ciclo</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">8</field></shadow></value></block></next></block></statement></block><block type=\"device_forever\" x=\"396\" y=\"0\"><comment pinned=\"false\" h=\"80\" w=\"160\">N¬∫ de lecturas r√°pidas por ciclo</comment><statement name=\"HANDLER\"><block type=\"controls_repeat_ext\"><comment pinned=\"false\" h=\"80\" w=\"160\">Tomar varias muestras r√°pidas para estabilizar la lectura</comment><value name=\"TIMES\"><shadow type=\"math_whole_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/)LB^}wgFg,p6FKKRi(W\">MUESTRAS</field></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"|/k;@hs3yqI6;)uyx4v.\">nivel</field><comment pinned=\"false\" h=\"80\" w=\"160\">lectura integrada (0..255)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"variables_change\"><field name=\"VAR\" id=\"=Yy[jhR@:bB)VK/gn%?Z\">suma</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"|/k;@hs3yqI6;)uyx4v.\">nivel</field></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"|/k;@hs3yqI6;)uyx4v.\">nivel</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\".(Y}IOSKJ4x=O5j3*nC=\">pico</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\".(Y}IOSKJ4x=O5j3*nC=\">pico</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"|/k;@hs3yqI6;)uyx4v.\">nivel</field></block></value></block></statement><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">pausa corta entre lecturas</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">20</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"X2p}7xVL4#EShI30nfm7\">promedio</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"=Yy[jhR@:bB)VK/gn%?Z\">suma</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/)LB^}wgFg,p6FKKRi(W\">MUESTRAS</field></block></value></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"dD;15q1:n|*u`EBl[cu%\">ledsEncendidos</field><comment pinned=\"false\" h=\"80\" w=\"160\">Mapear promedio (0..255) a n√∫mero de LEDs (0..25)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"X2p}7xVL4#EShI30nfm7\">promedio</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">25</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></value></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"dD;15q1:n|*u`EBl[cu%\">ledsEncendidos</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"dD;15q1:n|*u`EBl[cu%\">ledsEncendidos</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"dD;15q1:n|*u`EBl[cu%\">ledsEncendidos</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">25</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"dD;15q1:n|*u`EBl[cu%\">ledsEncendidos</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">25</field></shadow></value></block></statement><next><block type=\"pxt_controls_for\"><comment pinned=\"false\" h=\"80\" w=\"160\">Dibujar medidor usando toda la matriz 5x5 (de abajo hacia arriba, izquierda a derecha)</comment><value name=\"VAR\"><block type=\"variables_get_reporter\" deletable=\"false\"><field name=\"VAR\" id=\"a?7t#J,PpYJVu%(``SK9\">idx</field></block></value><value name=\"TO\"><shadow type=\"math_whole_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_number\"><field name=\"NUM\">24</field></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Y[*uhxBY^9E)^8rxY^;Q\">x</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_modulo\"><value name=\"DIVIDEND\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a?7t#J,PpYJVu%(``SK9\">idx</field></block></value><value name=\"DIVISOR\"><shadow type=\"math_number\"><field name=\"NUM\">5</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"1nlS9rRK?NPr;s6:st=N\">y</field><comment pinned=\"false\" h=\"80\" w=\"160\">fila invertida para que 0 est√© abajo</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">floor</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a?7t#J,PpYJVu%(``SK9\">idx</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">5</field></shadow></value></block></value></block></value></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a?7t#J,PpYJVu%(``SK9\">idx</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"dD;15q1:n|*u`EBl[cu%\">ledsEncendidos</field></block></value></block></value><statement name=\"DO0\"><block type=\"device_plot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Y[*uhxBY^9E)^8rxY^;Q\">x</field></block></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"1nlS9rRK?NPr;s6:st=N\">y</field></block></value></block></statement><statement name=\"ELSE\"><block type=\"device_unplot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Y[*uhxBY^9E)^8rxY^;Q\">x</field></block></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"1nlS9rRK?NPr;s6:st=N\">y</field></block></value></block></statement></block></next></block></next></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Si hay pico o promedio alto -&gt; alerta (icono + tono)</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\".(Y}IOSKJ4x=O5j3*nC=\">pico</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"[]zhPrr$3Yu324YEG%qT\">LIMITE_RUIDO</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"X2p}7xVL4#EShI30nfm7\">promedio</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"[]zhPrr$3Yu324YEG%qT\">LIMITE_RUIDO</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.No</field><next><block type=\"device_play_note\"><comment pinned=\"false\" h=\"80\" w=\"160\">Reproducir un tono corto (funciona si tu micro:bit tiene altavoz o un buzzer conectado)</comment><value name=\"note\"><shadow type=\"device_note\"><field name=\"name\">440</field></shadow></value><value name=\"duration\"><shadow type=\"device_beat\"><field name=\"fraction\">BeatFraction.Whole</field></shadow><block type=\"math_number\"><field name=\"NUM\">120</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">150</field></shadow></value><next><block type=\"device_clear_display\"></block></next></block></next></block></next></block></statement><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">Peque√±a pausa antes del siguiente ciclo</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">80</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":1200,"diffs":[[1,"/**\n * Detector de ruido para MakeCode (micro:bit V2)\n */\nlet y = 0\nlet x = 0\nlet ledsEncendidos = 0\nlet promedio = 0\nlet pico = 0\nlet suma = 0\nlet nivel = 0\n// Ajusta sensibilidad (0..255)\nlet LIMITE_RUIDO = 140\n// N¬∫ de lecturas r√°pidas por ciclo\nlet MUESTRAS = 8\n// N¬∫ de lecturas r√°pidas por ciclo\nbasic.forever(function () {\n    // Tomar varias muestras r√°pidas para estabilizar la lectura\n    for (let index = 0; index < MUESTRAS; index++) {\n        // lectura integrada (0..255)\n        nivel = input.soundLevel()\n        suma += nivel\n        if (nivel > pico) {\n            pico = nivel\n        }\n        // pausa corta entre lecturas\n        basic.pause(20)\n"]]},{"start1":674,"length1":852,"diffs":[[1,"    promedio = Math.round(suma / MUESTRAS)\n    // Mapear promedio (0..255) a n√∫mero de LEDs (0..25)\n    ledsEncendidos = Math.round(promedio * 25 / 255)\n    if (ledsEncendidos < 0) {\n        ledsEncendidos = 0\n    }\n    if (ledsEncendidos > 25) {\n        ledsEncendidos = 25\n    }\n    // Dibujar medidor usando toda la matriz 5x5 (de abajo hacia arriba, izquierda a derecha)\n    for (let idx = 0; idx <= 24; idx++) {\n        x = idx % 5\n        // fila invertida para que 0 est√© abajo\n        y = 4 - Math.floor(idx / 5)\n        if (idx < ledsEncendidos) {\n            led.plot(x, y)\n"]]},{"start1":1275,"length1":37,"diffs":[[1,"            led.unplot(x, y)\n"]]},{"start1":1320,"length1":560,"diffs":[[1,"    // Si hay pico o promedio alto -> alerta (icono + tono)\n    if (pico > LIMITE_RUIDO || promedio > LIMITE_RUIDO) {\n        basic.showIcon(IconNames.No)\n        // Reproducir un tono corto (funciona si tu micro:bit tiene altavoz o un buzzer conectado)\n        music.playTone(440, 120)\n        basic.pause(150)\n        basic.clearScreen()\n    }\n    // Peque√±a pausa antes del siguiente ciclo\n    basic.pause(80)\n})\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":335,"length1":31,"diffs":[[1,"    \"preferredEditor\": \"blocksprj\"\n"]]}]}]},{"timestamp":1764839822298,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":675,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"i(ztaK(b)(]IzW`e]bZ5\">MUESTRAS</variable><variable id=\"^G%1@G!j_URlhSu-!/%P\">nivel</variable><variable id=\"(-F[Fv#+}cl0|xmpuyb,\">suma</variable><variable id=\"~IA-bh(X]wuEw[fWX^H|\">pico</variable><variable id=\")-qM688/-?AYzuIEf;@Q\">promedio</variable><variable id=\"J$E/{Eqn7KeONH+X=v8l\">ledsEncendidos</variable><variable id=\"Nu9*;vG2/N`2POoLjR,|\">idx</variable><variable id=\"+gmo)-TO%6a($:C,hgro\">x</variable><variable id=\"m$u_di!pdiqe6N-d##k-\">y</variable><variable id=\"/wz5^?62$/#k_P{Q1A/D\">LIMITE_RUIDO</variable></variables><comment x=\"1468\" y=\"20\" w=\"350\" h=\"120\">\n"]]},{"start1":686,"length1":13902,"diffs":[[1,"</comment><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"/wz5^?62$/#k_P{Q1A/D\">LIMITE_RUIDO</field><comment pinned=\"false\" h=\"80\" w=\"160\">Ajusta sensibilidad (0..255)</comment><data>0</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">140</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i(ztaK(b)(]IzW`e]bZ5\">MUESTRAS</field><comment pinned=\"false\" h=\"80\" w=\"160\">N¬∫ de lecturas r√°pidas por ciclo</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">8</field></shadow></value></block></next></block></statement></block><block type=\"device_forever\" x=\"532\" y=\"79\"><comment pinned=\"false\" h=\"80\" w=\"160\">N¬∫ de lecturas r√°pidas por ciclo</comment><statement name=\"HANDLER\"><block type=\"controls_repeat_ext\"><comment pinned=\"false\" h=\"80\" w=\"160\">Tomar varias muestras r√°pidas</comment><value name=\"TIMES\"><shadow type=\"math_whole_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i(ztaK(b)(]IzW`e]bZ5\">MUESTRAS</field></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"^G%1@G!j_URlhSu-!/%P\">nivel</field><comment pinned=\"false\" h=\"80\" w=\"160\">lectura 0..255</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"variables_change\"><field name=\"VAR\" id=\"(-F[Fv#+}cl0|xmpuyb,\">suma</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^G%1@G!j_URlhSu-!/%P\">nivel</field></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^G%1@G!j_URlhSu-!/%P\">nivel</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"~IA-bh(X]wuEw[fWX^H|\">pico</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"~IA-bh(X]wuEw[fWX^H|\">pico</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^G%1@G!j_URlhSu-!/%P\">nivel</field></block></value></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">20</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\")-qM688/-?AYzuIEf;@Q\">promedio</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"(-F[Fv#+}cl0|xmpuyb,\">suma</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i(ztaK(b)(]IzW`e]bZ5\">MUESTRAS</field></block></value></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"J$E/{Eqn7KeONH+X=v8l\">ledsEncendidos</field><comment pinned=\"false\" h=\"80\" w=\"160\">Dibujar barra de LEDs (5x5)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\")-qM688/-?AYzuIEf;@Q\">promedio</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">25</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></value></block></value><next><block type=\"pxt_controls_for\"><value name=\"VAR\"><block type=\"variables_get_reporter\" deletable=\"false\"><field name=\"VAR\" id=\"Nu9*;vG2/N`2POoLjR,|\">idx</field></block></value><value name=\"TO\"><shadow type=\"math_whole_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_number\"><field name=\"NUM\">24</field></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"+gmo)-TO%6a($:C,hgro\">x</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_modulo\"><value name=\"DIVIDEND\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Nu9*;vG2/N`2POoLjR,|\">idx</field></block></value><value name=\"DIVISOR\"><shadow type=\"math_number\"><field name=\"NUM\">5</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m$u_di!pdiqe6N-d##k-\">y</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">floor</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Nu9*;vG2/N`2POoLjR,|\">idx</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">5</field></shadow></value></block></value></block></value></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Nu9*;vG2/N`2POoLjR,|\">idx</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"J$E/{Eqn7KeONH+X=v8l\">ledsEncendidos</field></block></value></block></value><statement name=\"DO0\"><block type=\"device_plot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"+gmo)-TO%6a($:C,hgro\">x</field></block></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m$u_di!pdiqe6N-d##k-\">y</field></block></value></block></statement><statement name=\"ELSE\"><block type=\"device_unplot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"+gmo)-TO%6a($:C,hgro\">x</field></block></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m$u_di!pdiqe6N-d##k-\">y</field></block></value></block></statement></block></next></block></next></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Alerta si supera l√≠mite</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"~IA-bh(X]wuEw[fWX^H|\">pico</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/wz5^?62$/#k_P{Q1A/D\">LIMITE_RUIDO</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\")-qM688/-?AYzuIEf;@Q\">promedio</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/wz5^?62$/#k_P{Q1A/D\">LIMITE_RUIDO</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.No</field><next><block type=\"device_play_note\"><value name=\"note\"><shadow type=\"device_note\"><field name=\"name\">440</field></shadow></value><value name=\"duration\"><shadow type=\"device_beat\"><field name=\"fraction\">BeatFraction.Whole</field></shadow><block type=\"math_number\"><field name=\"NUM\">120</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">150</field></shadow></value><next><block type=\"device_clear_display\"></block></next></block></next></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">80</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":365,"diffs":[[1,"// Detector de ruido con diferentes niveles de LED simulados en consola\n// Funciona en navegadores que soporten getUserMedia y Web Audio API\n\nconst NUM_LEDS = 5;         // cantidad de LEDs virtuales\nconst LIMITE_RUIDO = 50;    // nivel a partir del cual cambia de color\nconst MAX_PROMEDIO = 255;   // m√°ximo posible de promedio\n\nlet audioContext = null;\nlet analyser = null;\nlet dataArray = null;\nlet rafId = null;\n\n// Funci√≥n para iniciar detector\nasync function iniciarDetector() {\n    try {\n        // Pedimos micr√≥fono (cualquier dispositivo; si tienes auriculares ser√° uno de ellos)\n        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\n        // Inicializamos Web Audio API\n        audioContext = new (window.AudioContext || window.webkitAudioContext)();\n        const source = audioContext.createMediaStreamSource(stream);\n        analyser = audioContext.createAnalyser();\n        analyser.fftSize = 256;\n        source.connect(analyser);\n\n        dataArray = new Uint8Array(analyser.frequencyBinCount);\n\n        console.log(\"üé§ Detector de ruido iniciado...\");\n        medir();\n    } catch (err) {\n        console.error(\"Error al acceder al micr√≥fono:\", err);\n"]]},{"start1":1206,"length1":292,"diffs":[[1,"}\n\n// Funci√≥n que mide el ruido y muestra LEDs en consola\nfunction medir() {\n    analyser.getByteFrequencyData(dataArray);\n\n    // calculamos promedio del sonido\n    let suma = 0;\n    for (let i = 0; i < dataArray.length; i++) suma += dataArray[i];\n    const promedio = suma / dataArray.length;\n\n    // calculamos cu√°ntos LEDs encender\n    let ledsEncendidos = Math.round((promedio / MAX_PROMEDIO) * NUM_LEDS);\n    if (ledsEncendidos > NUM_LEDS) ledsEncendidos = NUM_LEDS;\n\n    // creamos la visualizaci√≥n de LEDs\n    let barra = \"\";\n    for (let i = 0; i < NUM_LEDS; i++) {\n        if (i < ledsEncendidos) {\n            // LED encendido con color seg√∫n nivel\n            if (i < NUM_LEDS / 2) barra += \"üü©\";      // verde\n            else if (i < NUM_LEDS - 1) barra += \"üü®\"; // amarillo\n            else barra += \"üü•\";                        // rojo\n"]]},{"start1":2075,"length1":29,"diffs":[[1,"            barra += \"‚¨õ\"; // apagado\n"]]},{"start1":2128,"length1":983,"diffs":[[1,"\n    console.clear();\n    console.log(`Nivel promedio: ${promedio.toFixed(2)}`);\n    console.log(barra);\n\n    // repetir continuamente\n    rafId = requestAnimationFrame(medir);\n}\n\n// Funci√≥n para detener detector\nfunction detenerDetector() {\n    if (rafId) cancelAnimationFrame(rafId);\n    if (audioContext) audioContext.close();\n    console.log(\"üõë Detector detenido.\");\n}\n\n// Iniciamos autom√°ticamente (puedes comentar si quieres control manual)\niniciarDetector();\n\n// Opcional: exponer detenerDetector() en consola\nwindow.detenerDetector = detenerDetector;\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":335,"length1":79,"diffs":[[1,"    \"preferredEditor\": \"tsprj\"\n"]]}]},{"type":"added","filename":"test.ts","value":"// aqu√≠ va el archivo \"tests\"; esto no se compilar√° cuando este paquete se utilice como una extensi√≥n.\n"}]}],"snapshots":[{"timestamp":1764838326817,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>","main.ts":"\n","README.md":"","pxt.json":"{\n    \"name\": \"Demo Detector de ruido\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"additionalFilePaths\": []\n}\n"}},{"timestamp":1764840127487,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"i(ztaK(b)(]IzW`e]bZ5\">MUESTRAS</variable><variable id=\"^G%1@G!j_URlhSu-!/%P\">nivel</variable><variable id=\"(-F[Fv#+}cl0|xmpuyb,\">suma</variable><variable id=\"~IA-bh(X]wuEw[fWX^H|\">pico</variable><variable id=\")-qM688/-?AYzuIEf;@Q\">promedio</variable><variable id=\"J$E/{Eqn7KeONH+X=v8l\">ledsEncendidos</variable><variable id=\"Nu9*;vG2/N`2POoLjR,|\">idx</variable><variable id=\"+gmo)-TO%6a($:C,hgro\">x</variable><variable id=\"m$u_di!pdiqe6N-d##k-\">y</variable><variable id=\"/wz5^?62$/#k_P{Q1A/D\">LIMITE_RUIDO</variable></variables><comment x=\"1448\" y=\"0\" w=\"350\" h=\"120\">\nDetector de ruido para micro:bit V2\n</comment><block type=\"pxt-on-start\" x=\"57\" y=\"8\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"/wz5^?62$/#k_P{Q1A/D\">LIMITE_RUIDO</field><comment pinned=\"false\" h=\"80\" w=\"160\">Ajusta sensibilidad (0..255)</comment><data>0</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">140</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i(ztaK(b)(]IzW`e]bZ5\">MUESTRAS</field><comment pinned=\"false\" h=\"80\" w=\"160\">N¬∫ de lecturas r√°pidas por ciclo</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">8</field></shadow></value></block></next></block></statement></block><block type=\"device_forever\" x=\"479\" y=\"127\"><comment pinned=\"false\" h=\"80\" w=\"160\">N¬∫ de lecturas r√°pidas por ciclo</comment></block><block type=\"input_logo_event\" x=\"745\" y=\"134\"><field name=\"action\">TouchButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"controls_repeat_ext\"><comment pinned=\"false\" h=\"80\" w=\"160\">Tomar varias muestras r√°pidas</comment><value name=\"TIMES\"><shadow type=\"math_whole_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i(ztaK(b)(]IzW`e]bZ5\">MUESTRAS</field></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"^G%1@G!j_URlhSu-!/%P\">nivel</field><comment pinned=\"false\" h=\"80\" w=\"160\">lectura 0..255</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"variables_change\"><field name=\"VAR\" id=\"(-F[Fv#+}cl0|xmpuyb,\">suma</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^G%1@G!j_URlhSu-!/%P\">nivel</field></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^G%1@G!j_URlhSu-!/%P\">nivel</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"~IA-bh(X]wuEw[fWX^H|\">pico</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"~IA-bh(X]wuEw[fWX^H|\">pico</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^G%1@G!j_URlhSu-!/%P\">nivel</field></block></value></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">20</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\")-qM688/-?AYzuIEf;@Q\">promedio</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"(-F[Fv#+}cl0|xmpuyb,\">suma</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i(ztaK(b)(]IzW`e]bZ5\">MUESTRAS</field></block></value></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"J$E/{Eqn7KeONH+X=v8l\">ledsEncendidos</field><comment pinned=\"false\" h=\"80\" w=\"160\">Dibujar barra de LEDs (5x5)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\")-qM688/-?AYzuIEf;@Q\">promedio</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">25</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></value></block></value><next><block type=\"pxt_controls_for\"><value name=\"VAR\"><block type=\"variables_get_reporter\" deletable=\"false\"><field name=\"VAR\" id=\"Nu9*;vG2/N`2POoLjR,|\">idx</field></block></value><value name=\"TO\"><shadow type=\"math_whole_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_number\"><field name=\"NUM\">24</field></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"+gmo)-TO%6a($:C,hgro\">x</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_modulo\"><value name=\"DIVIDEND\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Nu9*;vG2/N`2POoLjR,|\">idx</field></block></value><value name=\"DIVISOR\"><shadow type=\"math_number\"><field name=\"NUM\">5</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m$u_di!pdiqe6N-d##k-\">y</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">floor</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Nu9*;vG2/N`2POoLjR,|\">idx</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">5</field></shadow></value></block></value></block></value></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Nu9*;vG2/N`2POoLjR,|\">idx</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"J$E/{Eqn7KeONH+X=v8l\">ledsEncendidos</field></block></value></block></value><statement name=\"DO0\"><block type=\"device_plot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"+gmo)-TO%6a($:C,hgro\">x</field></block></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m$u_di!pdiqe6N-d##k-\">y</field></block></value></block></statement><statement name=\"ELSE\"><block type=\"device_unplot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"+gmo)-TO%6a($:C,hgro\">x</field></block></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m$u_di!pdiqe6N-d##k-\">y</field></block></value></block></statement></block></next></block></next></block></statement><next><block type=\"device_show_leds\"><field name=\"LEDS\">`\n        # . . . # \n        . # . # . \n        . . # . . \n        . # . # . \n        # . . . #\n        `</field><next><block type=\"device_show_leds\"><field name=\"LEDS\">`\n        . . . . . \n        . . . . . \n        . . . . . \n        . . . . . \n        . . . . .\n        `</field><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Alerta si supera l√≠mite</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"~IA-bh(X]wuEw[fWX^H|\">pico</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/wz5^?62$/#k_P{Q1A/D\">LIMITE_RUIDO</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\")-qM688/-?AYzuIEf;@Q\">promedio</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/wz5^?62$/#k_P{Q1A/D\">LIMITE_RUIDO</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"device_play_note\"><value name=\"note\"><shadow type=\"device_note\"><field name=\"name\">440</field></shadow></value><value name=\"duration\"><shadow type=\"device_beat\"><field name=\"fraction\">BeatFraction.Whole</field></shadow><block type=\"math_number\"><field name=\"NUM\">120</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">150</field></shadow></value><next><block type=\"device_clear_display\"></block></next></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">80</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"device_show_leds\" disabled-reasons=\"pxt_automatic_disabled\" x=\"809\" y=\"1439\"><field name=\"LEDS\">`\n        . . . . . \n        . . . . . \n        . . . . . \n        . . . . . \n        . . . . .\n        `</field></block></xml>","main.ts":"","README.md":"","pxt.json":"{\n    \"name\": \"Demo Detector de ruido\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\",\n        \"audio-recording\": \"*\",\n        \"pxt-sonar\": \"github:microsoft/pxt-sonar#v0.0.6\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"preferredEditor\": \"blocksprj\"\n}\n"}}],"shares":[],"lastSaveTime":1764840232330}